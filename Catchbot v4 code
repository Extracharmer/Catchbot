
#include <AccelStepper.h>
#include <math.h>

AccelStepper stepper(AccelStepper::DRIVER, 2, 3);

const int ir1 = 4;
const int ir2 = 5;

unsigned long t1 = 0;
unsigned long t2 = 0;

long backstep = 0;

float dt = 0;
float vxi= 0;
float x = 0;
float t = 0;

const float sensDist = 0.04;
const float y = 0.825;
const float g = 9.8;

void setup() {
  Serial.begin(9600);

  pinMode(ir1, INPUT);
  pinMode(ir2, INPUT);

  //stepper.setSpeed(100.0);
  stepper.setMaxSpeed(10000.0);
  stepper.setAcceleration(5000.0);
  stepper.moveTo(2000);


}

void loop() {
 /* if (stepper.distanceToGo()==0)
  stepper.moveTo(-stepper.currentPosition());
  stepper.run();

  if (digitalRead(ir1) == LOW && t1 == 0) {
    t1 = millis();
  }

  if (digitalRead(ir2) == LOW && t1 != 0 && t2 == 0) {
    t2 = millis();
  }

  if (t1 != 0 && t2 != 0) {

    dt = (t2 - t1) / 1000.0;
    vxi = sensDist / dt;
    Serial.println(vxi);

    t = sqrt((2 * y) / g);
    x = vxi * t;

    long mStep = x * 1000.0 * 20.0;

    stepper.moveTo(mStep);

    while (stepper.distanceToGo() != 0) {
      stepper.run();
    }

    delay(500);

    stepper.moveTo(0);

    while (stepper.distanceToGo() != 0) {
      stepper.run();
    }

    t1 = 0;
    t2 = 0;
  }
  */
}
